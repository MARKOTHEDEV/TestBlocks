!function(){"use strict";const e=new class{constructor(){this.isPicking=!1,this.overlay=null,this.currentElement=null,this.handleMouseOver=e=>{if(!this.isPicking||!this.overlay)return;const t=e.target;this.isValidTarget(t)&&(this.currentElement=t,this.highlightElement(t))},this.handleMouseOut=()=>{this.overlay&&(this.overlay.style.display="none"),this.currentElement=null},this.handleClick=e=>{if(!this.isPicking||!this.currentElement)return;e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();const t={__qa:!0,type:"ELEMENT_PICKED",qaId:this.ensureQaId(this.currentElement),role:this.inferRole(this.currentElement),name:this.getAccessibleName(this.currentElement),frameChain:this.getFrameChain(this.currentElement)};window.postMessage(t,"*"),this.stop()},this.setupMessageListener(),this.autoGenerateIds()}start(){this.isPicking||(this.isPicking=!0,this.createOverlay(),this.addEventListeners())}stop(){this.isPicking&&(this.isPicking=!1,this.removeOverlay(),this.removeEventListeners())}ensureQaId(e){const t=e.getAttribute("data-testid")||e.getAttribute("data-test")||e.getAttribute("data-qa");if(t)return e.setAttribute("data-qa-id",t),t;const n=this.generateStableId(e);return e.setAttribute("data-qa-id",n),n}autoGenerateIds(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>this.generateIdsForInteractiveElements()):this.generateIdsForInteractiveElements();let e=null;new MutationObserver(t=>{e||(e=window.setTimeout(()=>{t.forEach(e=>{e.addedNodes.forEach(e=>{1===e.nodeType&&this.ensureQaIdForElement(e)})}),e=null},200))}).observe(document.body,{childList:!0,subtree:!0})}generateIdsForInteractiveElements(){["input","button","select","textarea","a[href]","[onclick]",'[role="button"]','[role="link"]',"[tabindex]"].forEach(e=>{document.querySelectorAll(e).forEach(e=>{this.ensureQaIdForElement(e)})})}ensureQaIdForElement(e){e.getAttribute("data-qa-id")||this.ensureQaId(e)}setupMessageListener(){window.addEventListener("message",e=>{if(!0===e.data?.__qa)switch(e.data.type){case"START_PICK":this.start();break;case"STOP_PICK":this.stop()}})}createOverlay(){this.overlay=document.createElement("div"),this.overlay.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 123, 255, 0.1);\n      border: 2px solid #007bff;\n      pointer-events: none;\n      z-index: 2147483647;\n      display: none;\n    ",document.body.appendChild(this.overlay)}removeOverlay(){this.overlay&&(this.overlay.remove(),this.overlay=null)}addEventListeners(){document.addEventListener("mouseover",this.handleMouseOver),document.addEventListener("mouseout",this.handleMouseOut),document.addEventListener("click",this.handleClick,!0)}removeEventListeners(){document.removeEventListener("mouseover",this.handleMouseOver),document.removeEventListener("mouseout",this.handleMouseOut),document.removeEventListener("click",this.handleClick,!0)}isValidTarget(e){const t=e.tagName.toLowerCase();if(["script","style","meta","link","title","head"].includes(t))return!1;const n=e.getBoundingClientRect();return 0!==n.width&&0!==n.height}highlightElement(e){if(!this.overlay)return;const t=e.getBoundingClientRect();this.overlay.style.display="block",this.overlay.style.top=`${t.top}px`,this.overlay.style.left=`${t.left}px`,this.overlay.style.width=`${t.width}px`,this.overlay.style.height=`${t.height}px`}generateStableId(e){const t=`qa:${this.inferRole(e)||"node"}:${this.getHint(e)}`;return this.ensureUniqueId(t)}ensureUniqueId(e){let t=0,n=e;for(;document.querySelector(`[data-qa-id="${n}"]`);)t++,n=`${e}:${t}`;return n}buildSemanticSignature(e){const t=e.tagName.toLowerCase(),n=this.inferRole(e),i=this.getAccessibleName(e),r=e.type||"",s=e.href?new URL(e.href).pathname:"",a=this.getParentHint(e),o=this.getSiblingOrdinal(e),l=e.id||"",h=e.className||"",d=e.textContent?.trim().substring(0,30)||"";return JSON.stringify({tag:t,role:n,name:i?.substring(0,50),inputType:r,href:s.substring(0,100),parentHint:a,siblingOrdinal:o,id:l,className:h.substring(0,50),textContent:d})}inferRole(e){const t=e.getAttribute("role");if(t)return t;const n=e.tagName.toLowerCase(),i={button:"button",a:"link",input:"textbox",textarea:"textbox",select:"combobox",img:"img",h1:"heading",h2:"heading",h3:"heading",h4:"heading",h5:"heading",h6:"heading"};if(i[n])return i[n];if("input"===n){return{button:"button",submit:"button",reset:"button",checkbox:"checkbox",radio:"radio",email:"textbox",password:"textbox",text:"textbox",search:"searchbox"}[e.type]||"textbox"}}getAccessibleName(e){const t=e.getAttribute("aria-label");if(t)return t.trim();const n=e.getAttribute("aria-labelledby");if(n){const e=document.getElementById(n);if(e)return e.textContent?.trim()}const i=e.placeholder;if(i)return i.trim();const r=e.alt;if(r)return r.trim();const s=e.tagName.toLowerCase();if(["button","a"].includes(s))return e.textContent?.trim();if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);if(t)return t.textContent?.trim()}}getHint(e){const t=this.getAccessibleName(e);if(t)return t.substring(0,12).replace(/[^a-zA-Z0-9]/g,"").toLowerCase();const n=e.id;if(n)return n.substring(0,12).replace(/[^a-zA-Z0-9]/g,"").toLowerCase();const i=e.placeholder;if(i)return i.substring(0,12).replace(/[^a-zA-Z0-9]/g,"").toLowerCase();return e.tagName.toLowerCase()}getParentHint(e){let t=e.parentElement,n=0;for(;t&&n<3;){const e=t.id;if(e)return e;const i=Array.from(t.classList).filter(e=>!e.includes("hash")&&e.length<20).slice(0,2);if(i.length>0)return i.join("-");t=t.parentElement,n++}return""}getSiblingOrdinal(e){const t=e.parentElement;if(!t)return 0;return Array.from(t.children).filter(t=>t.tagName===e.tagName).indexOf(e)}getFrameChain(e){const t=[];let n=e;for(;n;){const e=n.getRootNode();if(!(e instanceof ShadowRoot))break;{const i=e.host;t.unshift(i.tagName.toLowerCase()),n=i}}return t}sha256(e){let t=0;for(let n=0;n<e.length;n++){t=(t<<5)-t+e.charCodeAt(n),t&=t}return Math.abs(t).toString(36)}};window.__QATagger=e}();
//# sourceMappingURL=qa-tagger.v1.js.map
